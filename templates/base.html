{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ModernBlog{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#64748B',
                        accent: '#6366F1',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        .dark ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Print styles */
        @media print {
            nav, footer, aside, .no-print { display: none !important; }
            article { max-width: 100% !important; }
        }
        
        /* Focus visible for accessibility */
        *:focus-visible {
            outline: 2px solid #3B82F6;
            outline-offset: 2px;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
    
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded-lg z-50">
        Skip to main content
    </a>

    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40 backdrop-blur-sm bg-white/95 dark:bg-gray-800/95">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="{% url 'core:home' %}" class="flex items-center space-x-3 group">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center group-hover:bg-blue-700 transition">
                            <i class="fas fa-blog text-white text-xl"></i>
                        </div>
                        <span class="text-2xl font-bold text-gray-900 dark:text-white">Echo<span class="text-blue-600">Tales</span></span>
                    </a>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-1">
                    <a href="{% url 'core:home' %}" class="px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Home</a>
                    <a href="{% url 'blog:post_list' %}" class="px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Blog</a>
                    <a href="{% url 'blog:category_list' %}" class="px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Categories</a>
                    <a href="{% url 'core:about' %}" class="px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">About</a>
                    <a href="{% url 'core:contact' %}" class="px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Contact</a>
                </div>
                
                <!-- Right Side Actions -->
                <div class="flex items-center space-x-3">
                    <!-- Search Button -->
                    <button id="searchToggle" class="p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition" aria-label="Search">
                        <i class="fas fa-search"></i>
                    </button>
                    
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition" aria-label="Toggle dark mode">
                        <i class="fas fa-sun dark:hidden"></i>
                        <i class="fas fa-moon hidden dark:inline"></i>
                    </button>
                    
                    {% if user.is_authenticated %}
                        <div class="relative group">
                            <button class="flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                                {% if user.avatar %}
                                    <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="w-8 h-8 rounded-full">
                                {% else %}
                                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm font-bold">{{ user.username.0|upper }}</span>
                                    </div>
                                {% endif %}
                                <span class="hidden lg:inline font-medium">{{ user.username }}</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                                <a href="{% url 'blog:author_posts' user.username %}" class="flex items-center space-x-2 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                    <i class="fas fa-file-alt w-4"></i>
                                    <span>My Posts</span>
                                </a>
                                <a href="/admin/" class="flex items-center space-x-2 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                    <i class="fas fa-tachometer-alt w-4"></i>
                                    <span>Dashboard</span>
                                </a>
                                <div class="border-t border-gray-200 dark:border-gray-700"></div>
                                <form method="post" action="{% url 'admin:logout' %}">
                                    {% csrf_token %}
                                    <button type="submit" class="w-full flex items-center space-x-2 px-4 py-3 hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400 transition">
                                        <i class="fas fa-sign-out-alt w-4"></i>
                                        <span>Logout</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% else %}
                        <a href="/admin/login/" target="_blank" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition">
                            Login
                        </a>
                    {% endif %}
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
            <div class="px-4 py-4 space-y-1">
                <a href="{% url 'core:home' %}" class="block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Home</a>
                <a href="{% url 'blog:post_list' %}" class="block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Blog</a>
                <a href="{% url 'blog:category_list' %}" class="block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Categories</a>
                <a href="{% url 'core:about' %}" class="block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">About</a>
                <a href="{% url 'core:contact' %}" class="block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium transition">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Search Modal -->
    <div id="searchModal" class="hidden fixed inset-0 bg-black/50 z-50 backdrop-blur-sm">
        <div class="min-h-screen px-4 flex items-start justify-center pt-20">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Search Articles</h3>
                        <button id="closeSearch" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                            <i class="fas fa-times text-gray-600 dark:text-gray-400"></i>
                        </button>
                    </div>
                    <form method="get" action="{% url 'blog:post_list' %}">
                        <div class="relative">
                            <input type="text" name="q" placeholder="Search for articles..." 
                                   class="w-full px-4 py-3 pl-12 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button type="submit" class="mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                            Search
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages -->
    {% if messages %}
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
            {% for message in messages %}
                <div class="flex items-center justify-between p-4 rounded-lg mb-3 {% if message.tags == 'success' %}bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800{% elif message.tags == 'error' %}bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800{% elif message.tags == 'warning' %}bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800{% else %}bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800{% endif %}">
                    <div class="flex items-center space-x-3">
                        <i class="fas {% if message.tags == 'success' %}fa-check-circle text-green-600{% elif message.tags == 'error' %}fa-exclamation-circle text-red-600{% elif message.tags == 'warning' %}fa-exclamation-triangle text-yellow-600{% else %}fa-info-circle text-blue-600{% endif %}"></i>
                        <p class="font-medium {% if message.tags == 'success' %}text-green-800 dark:text-green-200{% elif message.tags == 'error' %}text-red-800 dark:text-red-200{% elif message.tags == 'warning' %}text-yellow-800 dark:text-yellow-200{% else %}text-blue-800 dark:text-blue-200{% endif %}">{{ message }}</p>
                    </div>
                    <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main Content -->
    <main id="main-content" class="min-h-screen">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 mt-20 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- About -->
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-blog text-white"></i>
                        </div>
                        <span class="text-xl font-bold text-white">EchoTales</span>
                    </div>
                    <p class="text-sm text-gray-400 mb-4">Discover stories, thinking, and expertise from writers on any topic.</p>
                    <div class="flex space-x-2">
                        <a href="#" class="w-9 h-9 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center transition">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="w-9 h-9 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center transition">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="w-9 h-9 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center transition">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="#" class="w-9 h-9 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center transition">
                            <i class="fab fa-github"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-white font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="{% url 'core:home' %}" class="hover:text-white transition">Home</a></li>
                        <li><a href="{% url 'blog:post_list' %}" class="hover:text-white transition">Blog</a></li>
                        <li><a href="{% url 'blog:category_list' %}" class="hover:text-white transition">Categories</a></li>
                        <li><a href="{% url 'core:about' %}" class="hover:text-white transition">About Us</a></li>
                        <li><a href="{% url 'core:contact' %}" class="hover:text-white transition">Contact</a></li>
                    </ul>
                </div>
                
                <!-- Resources -->
                <div>
                    <h3 class="text-white font-bold mb-4">Resources</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-white transition">Getting Started</a></li>
                        <li><a href="#" class="hover:text-white transition">Documentation</a></li>
                        <li><a href="#" class="hover:text-white transition">Community</a></li>
                        <li><a href="#" class="hover:text-white transition">Help Center</a></li>
                        <li><a href="#" class="hover:text-white transition">API Reference</a></li>
                    </ul>
                </div>
                
                <!-- Newsletter -->
                <div>
                    <h3 class="text-white font-bold mb-4">Stay Updated</h3>
                    <p class="text-sm text-gray-400 mb-4">Get the latest posts delivered to your inbox</p>
                    <form id="footerNewsletterForm" class="space-y-2">
                        {% csrf_token %}
                        <input type="email" name="email" placeholder="your@email.com" required 
                               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500">
                        <button type="submit" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                            Subscribe
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-400">
                <p>© 2025 EchoTales. All rights reserved.</p>
               <div class="flex flex-wrap items-center justify-center gap-x-8 gap-y-4 text-sm md:text-base">
    <a href="{% url 'core:privacy_policy' %}"
       class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 font-medium transition-colors duration-200">
        Privacy Policy
    </a>
    <span class="text-gray-400 dark:text-gray-600">·</span>
    <a href="{% url 'core:terms' %}"
       class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 font-medium transition-colors duration-200">
        Terms of Service
    </a>
    <span class="text-gray-400 dark:text-gray-600">·</span>
    <a href="{% url 'core:cookie_policy' %}"
       class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 font-medium transition-colors duration-200">
        Cookie Policy
    </a>
    <span class="text-gray-400 dark:text-gray-600">·</span>
    <a href="{% url 'core:faq' %}"
       class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 font-medium transition-colors duration-200">
        FAQ
    </a>
</div>
            </div>
        </div>
    </footer>

    <script src="{% static 'js/dark_mode.js' %}"></script>
    <script>
        // Mobile menu toggle
        document.getElementById('mobileMenuBtn')?.addEventListener('click', function() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        });

        // Search modal
        const searchModal = document.getElementById('searchModal');
        document.getElementById('searchToggle')?.addEventListener('click', () => {
            searchModal.classList.remove('hidden');
            searchModal.querySelector('input').focus();
        });
        document.getElementById('closeSearch')?.addEventListener('click', () => {
            searchModal.classList.add('hidden');
        });
        searchModal?.addEventListener('click', (e) => {
            if (e.target === searchModal) searchModal.classList.add('hidden');
        });

        // Newsletter form
        document.getElementById('footerNewsletterForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const button = this.querySelector('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Subscribing...';
            button.disabled = true;
            
            const formData = new FormData(this);
            fetch("{% url 'blog:newsletter_subscribe' %}", {
                method: 'POST',
                body: formData,
                headers: { 'X-CSRFToken': formData.get('csrfmiddlewaretoken') }
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    button.innerHTML = '<i class="fas fa-check"></i> Subscribed!';
                    button.classList.add('bg-green-600', 'hover:bg-green-700');
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    this.reset();
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.classList.remove('bg-green-600', 'hover:bg-green-700');
                        button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        button.disabled = false;
                    }, 3000);
                } else {
                    alert(data.message || 'Subscription failed');
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            })
            .catch(() => {
                alert('Something went wrong. Please try again.');
                button.innerHTML = originalText;
                button.disabled = false;
            });
        });

        // Auto-hide messages after 5 seconds
        setTimeout(() => {
            document.querySelectorAll('[class*="bg-green-50"], [class*="bg-red-50"], [class*="bg-yellow-50"], [class*="bg-blue-50"]').forEach(msg => {
                if(msg.querySelector('.fa-check-circle, .fa-exclamation-circle, .fa-info-circle')) {
                    msg.style.transition = 'opacity 0.5s';
                    msg.style.opacity = '0';
                    setTimeout(() => msg.remove(), 500);
                }
            });
        }, 5000);
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>