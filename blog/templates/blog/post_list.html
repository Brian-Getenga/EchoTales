<!-- templates/blog/post_list.html -->
{% extends 'base.html' %}

{% block title %}
    {% if query %}Search: {{ query }} - {% endif %}All Posts - ModernBlog
{% endblock %}

{% block extra_head %}
<style>
    :root {
        --primary: #3B82F6;
        --primary-hover: #2563EB;
        --gray-100: #F3F4F6;
        --gray-200: #E5E7EB;
        --gray-300: #D1D5DB;
        --gray-500: #6B7280;
        --gray-700: #374151;
        --gray-900: #111827;
    }
    .dark {
        --gray-100: #1F2937;
        --gray-200: #374151;
        --gray-300: #4B5563;
        --gray-500: #9CA3AF;
        --gray-700: #D1D5DB;
        --gray-900: #F3F4F6;
    }

    .card {
        @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 transition-all duration-300;
    }
    .card:hover {
        @apply shadow-xl border-primary/30 -translate-y-1;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<header class="bg-gray-50 dark:bg-gray-900 py-20 border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-7xl mx-auto px-6 lg:px-8 text-center">
        <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 dark:text-white mb-4">
            Explore Stories
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-400 mb-10 max-w-2xl mx-auto">
            Thoughtful writing on design, development, and everything in between.
        </p>

        <!-- Search -->
        <form method="get" class="max-w-2xl mx-auto">
            <div class="flex shadow-sm rounded-xl overflow-hidden border border-gray-300 dark:border-gray-700 focus-within:border-primary focus-within:ring-4 focus-within:ring-primary/10">
                <input 
                    type="text" 
                    name="q" 
                    value="{{ query|default:'' }}" 
                    placeholder="Search posts..." 
                    class="flex-1 px-6 py-4 text-lg bg-transparent focus:outline-none"
                >
                <button class="px-8 bg-primary hover:bg-primary-hover text-white font-medium transition">
                    Search
                </button>
            </div>
        </form>

        {% if query %}
        <div class="mt-6 text-sm text-gray-600 dark:text-gray-400">
            Showing <strong>{{ posts.paginator.count }}</strong> result{{ posts.paginator.count|pluralize }} for “{{ query }}”
        </div>
        {% endif %}
    </div>
</header>

<div class="max-w-7xl mx-auto px-6 lg:px-8 py-16">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

        <!-- Main Content -->
        <main class="lg:col-span-2 space-y-16">

            <!-- Featured Posts -->
            {% if featured_posts and not query %}
            <section>
                <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white mb-8 flex items-center gap-4">
                    <span>Featured</span>
                    <div class="flex-1 h-px bg-gray-300 dark:bg-gray-700"></div>
                </h2>

                <div class="space-y-8">
                    {% for post in featured_posts %}
                    <article class="card overflow-hidden">
                        <a href="{{ post.get_absolute_url }}" class="block hover:no-underline">
                            <div class="grid md:grid-cols-3 gap-0">
                                <div class="relative overflow-hidden bg-gray-200 dark:bg-gray-700">
                                    {% if post.featured_image %}
                                        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="w-full h-64 md:h-full object-cover transition-transform duration-500 hover:scale-105">
                                    {% else %}
                                        <div class="w-full h-64 md:h-full bg-gradient-to-br from-blue-500 to-indigo-600"></div>
                                    {% endif %}
                                    <div class="absolute top-4 left-4">
                                        <span class="px-3 py-1 bg-yellow-500 text-white text-xs font-bold rounded-full">Featured</span>
                                    </div>
                                </div>

                                <div class="md:col-span-2 p-8">
                                    {% if post.category %}
                                        <span class="inline-block px-4 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 rounded-full text-sm font-medium mb-3">
                                            {{ post.category.name }}
                                        </span>
                                    {% endif %}
                                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-3 hover:text-primary transition">
                                        {{ post.title }}
                                    </h3>
                                    <p class="text-gray-600 dark:text-gray-400 mb-5 line-clamp-3">{{ post.excerpt|default:"" }}</p>

                                    <div class="flex items-center justify-between text-sm text-gray-500">
                                        <div class="flex items-center gap-3">
                                            {% if post.author.avatar %}
                                                <img src="{{ post.author.avatar.url }}" alt="{{ post.author.get_full_name }}" class="w-9 h-9 rounded-full">
                                            {% else %}
                                                <div class="w-9 h-9 bg-primary rounded-full flex items-center justify-center text-white font-bold text-sm">
                                                    {{ post.author.username.0|upper }}
                                                </div>
                                            {% endif %}
                                            <span class="font-medium text-gray-900 dark:text-white">{{ post.author.get_full_name }}</span>
                                        </div>
                                        <time>{{ post.published_at|date:"M d, Y" }}</time>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </article>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- All Posts -->
            <section>
                <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white mb-8 flex items-center gap-4">
                    <span>{% if query %}Results{% else %}Latest Posts{% endif %}</span>
                    <div class="flex-1 h-px bg-gray-300 dark:bg-gray-700"></div>
                </h2>

                {% if posts %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    {% for post in posts %}
                    <article class="card">
                        <a href="{{ post.get_absolute_url }}" class="block hover:no-underline">
                            <div class="h-48 overflow-hidden bg-gray-200 dark:bg-gray-700">
                                {% if post.featured_image %}
                                    <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                                {% else %}
                                    <div class="w-full h-full bg-gradient-to-br from-blue-400 to-indigo-600"></div>
                                {% endif %}
                            </div>

                            <div class="p-6 space-y-4">
                                <div class="flex items-center justify-between text-sm">
                                    {% if post.category %}
                                        <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 rounded-full font-medium">
                                            {{ post.category.name }}
                                        </span>
                                    {% endif %}
                                    <time class="text-gray-500">{{ post.published_at|date:"M d, Y" }}</time>
                                </div>

                                <h3 class="text-xl font-bold text-gray-900 dark:text-white hover:text-primary transition line-clamp-2">
                                    {{ post.title }}
                                </h3>

                                <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-2">
                                    {{ post.excerpt|default:"" }}
                                </p>

                                <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500">
                                    <span class="font-medium text-gray-700 dark:text-gray-300">{{ post.author.get_full_name }}</span>
                                    <div class="flex items-center gap-4">
                                        <span>Views: {{ post.views }}</span>
                                        <span>Likes: {{ post.like_count|default:0 }}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </article>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if posts.has_other_pages %}
                <div class="flex justify-center items-center gap-3 mt-12">
                    {% if posts.has_previous %}
                        <a href="?page=1{% if query %}&q={{ query }}{% endif %}" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition">First</a>
                        <a href="?page={{ posts.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition">Previous</a>
                    {% endif %}

                    <span class="px-6 py-3 bg-primary text-white rounded-lg font-medium">
                        Page {{ posts.number }} / {{ posts.paginator.num_pages }}
                    </span>

                    {% if posts.has_next %}
                        <a href="?page={{ posts.next_page_number }}{% if query %}&q={{ query }}{% endif %}" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition">Next</a>
                        <a href="?page={{ posts.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition">Last</a>
                    {% endif %}
                </div>
                {% endif %}

                {% else %}
                <div class="text-center py-20">
                    <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center">
                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                    <p class="text-2xl font-semibold text-gray-700 dark:text-gray-300">No posts found</p>
                    <p class="text-gray-500 mt-2">Try a different search term</p>
                </div>
                {% endif %}
            </section>
        </main>

        <!-- Sidebar -->
        <aside class="space-y-8">
            <!-- Trending -->
            {% if popular_posts %}
            <div class="card p-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
                    <span>Trending</span>
                </h3>
                <div class="space-y-5">
                    {% for post in popular_posts %}
                    <a href="{{ post.get_absolute_url }}" class="flex gap-4 group">
                        <div class="w-20 h-20 rounded-lg overflow-hidden flex-shrink-0 bg-gray-200 dark:bg-gray-700">
                            {% if post.featured_image %}
                                <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="w-full h-full object-cover group-hover:scale-105 transition">
                            {% else %}
                                <div class="w-full h-full bg-gradient-to-br from-blue-400 to-indigo-600"></div>
                            {% endif %}
                        </div>
                        <div>
                            <h4 class="font-medium text-sm line-clamp-2 group-hover:text-primary transition">
                                {{ post.title }}
                            </h4>
                            <p class="text-xs text-gray-500 mt-1">{{ post.views }} views</p>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Categories -->
            {% if categories %}
            <div class="card p-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-5">Categories</h3>
                <div class="space-y-2">
                    {% for category in categories %}
                    <a href="{{ category.get_absolute_url }}" class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition group">
                        <span class="flex items-center gap-3 font-medium group-hover:text-primary">
                            <span>{{ category.icon|default:"Document" }}</span>
                            <span>{{ category.name }}</span>
                        </span>
                        <span class="text-sm text-gray-500">{{ category.num_posts }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Tags -->
            {% if tags %}
            <div class="card p-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-5">Popular Tags</h3>
                <div class="flex flex-wrap gap-2">
                    {% for tag in tags %}
                    <a href="{{ tag.get_absolute_url }}" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium hover:bg-primary hover:text-white transition">
                        #{{ tag.name }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </aside>
    </div>
</div>
{% endblock %}